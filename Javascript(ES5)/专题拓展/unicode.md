# Unicode 和 UTF-8 一级 UTF-16

## Unicode

Unicode（中文：万国码、国际码、统一码、单一码）是电脑科学领域里的一项业界标准。它对世界上大部分的文字系统进行了整理、编码，使得电脑可以用更为简单的方式来呈现和处理文字。

Unicode 是为了解决传统的字元编码方案的局限而产生的，例如 ISO 8859-1 所定义的字元虽然在不同的国家中广泛地使用，可是在不同国家间却经常出现不相容的情况。很多传统的编码方式都有一个共同的问题，即容许电脑处理双语环境（通常使用拉丁字母以及其本地语言），但却无法同时支援多语言环境（指可同时处理多种语言混合的情况）。

在文字处理方面，统一码为每一个字符而非字形定义唯一的代码（即一个整数）。换句话说，统一码以一种抽象的方式（即数字）来处理字符，并将视觉上的演绎工作（例如字体大小、外观形状、字体形态、文体等）留给其他软件来处理，例如网页浏览器或是文字处理器。

目前，几乎所有电脑系统都支持基本拉丁字母，并各自支持不同的其他编码方式。Unicode 为了和它们相互兼容，其首 256 字元保留给 ISO 8859-1 所定义的字元，使既有的西欧语系文字的转换不需特别考量；并且把大量相同的字元重复编到不同的字元码中去，使得旧有纷杂的编码方式得以和 Unicode 编码间互相直接转换，而不会遗失任何资讯。举例来说，全形格式区段包含了主要的拉丁字母的全形格式，在中文、日文、以及韩文字形当中，这些字元以全形的方式来呈现，而不以常见的半形形式显示，这对竖排文字和等宽排列文字有重要作用。

在表示一个 Unicode 的字元时，通常会用 “U+” 然后紧接着一组十六进位的数字来表示这一个字元。在基本多文种平面（英文：Basic Multilingual Plane，简写 BMP。又称为“零号平面”、plane 0）里的所有字元，要用四个数字（即两个 char,16bit , 例如 U+4AE0，共支持六万多个字符）；在零号平面以外的字元则需要使用五个或六个数字。旧版的 Unicode 标准使用相近的标记方法，但却有些微小差异：在 Unicode 3.0 里使用 “U-” 然后紧接着八个数字，而 “U+” 则必须随后紧接着四个数字。

### 编码方式

统一码的编码方式与 ISO 10646 的通用字符集概念相对应。目前实际应用的统一码版本对应于 UCS-2，使用 16 位的编码空间。也就是每个字符占用 2 个字节。这样理论上一共最多可以表示 2^16（即 65536）个字符。基本满足各种语言的使用。实际上目前版本的统一码并未完全使用这 16 位编码，而是保留了大量空间以作为特殊使用或将来扩展。

上述 16 位统一码字符构成基本多文种平面。最新（但未实际广泛使用）的统一码版本定义了 16 个辅助平面，两者合起来至少需要占据 21 位的编码空间，比 3 字节略少。但事实上辅助平面字符仍然占用 4 字节编码空间，与 UCS-4 保持一致。未来版本会扩充到 ISO 10646-1 实现级别 3，即涵盖 UCS-4 的所有字符。UCS-4 是一个更大的尚未填充完全的 31 位字符集，加上恒为 0 的首位，共需占据 32 位，即 4 字节。理论上最多能表示 2^31 个字符，完全可以涵盖一切语言所用的符号。

基本多文种平面的字符的编码为 `U+hhhh`，其中每个 h 代表一个十六进制数字，与 UCS-2 编码完全相同。而其对应的 4 字节 UCS-4 编码后两个字节一致，前两个字节则所有位均为 0。

### 实现方式

Unicode 的实现方式不同于编码方式。一个字符的 Unicode 编码是确定的。但是在实际传输过程中，由于不同系统平台的设计不一定一致，以及出于节省空间的目的，对 Unicode 编码的实现方式有所不同。Unicode 的实现方式称为 **Unicode 转换格式**（Unicode Transformation Format，简称为 **UTF**）

例如，如果一个仅包含基本 7 位 ASCII 字符的 Unicode 文件，如果每个字符都使用 2 字节的原 Unicode 编码传输，其第一字节的 8 位始终为 0。这就造成了比较大的浪费。对于这种情况，可以使用 **UTF-8** 编码，这是一种**变长编码**，它将基本 7 位 ASCII 字符仍用 7 位编码表示，占用一个字节（首位补 0）。而遇到与其他 Unicode 字符混合的情况，将按一定算法转换，每个字符使用 1-3 个字节编码，并利用首位为 0 或 1 进行识别。这样对以 7 位 ASCII 字符为主的西文文档就大幅节省了编码长度（具体方案参见 UTF-8）。类似的，对未来会出现的需要 4 个字节的辅助平面字符和其他 UCS-4 扩充字符，2 字节编码的 UTF-16 也需要通过一定的算法进行转换。

再如，如果直接使用与 Unicode 编码一致（仅限于 BMP 字符）的 UTF-16 编码，由于每个字符占用了两个字节，在麦金塔电脑（Mac）机和个人电脑上，对字节顺序的理解是不一致的。这时同一字节流可能会被解释为不同内容，如某字符为十六进制编码 4E59，按两个字节拆分为 4E 和 59，在 Mac 上读取时是从低字节开始，那么在 Mac OS 会认为此 4E59 编码为 594E，找到的字符为“奎”，而在 Windows 上从高字节开始读取，则编码为 U+4E59 的字符为“乙”。就是说在 Windows 下以 UTF-16 编码保存一个字符“乙”，在 Mac OS 环境下开启会显示成“奎”。此类情况说明 UTF-16 的编码顺序若不加以人为定义就可能发生混淆，于是在 UTF-16 编码实现方式中使用了大端序（Big-Endian，简写为 UTF-16 BE）、小端序（Little-Endian，简写为 UTF-16 LE）的概念，以及可附加的位元组顺序记号解决方案，目前在 PC 机上的 Windows 系统和 Linux 系统对于 UTF-16 编码默认使用 UTF-16 LE。（具体方案参见 UTF-16）

此外 Unicode 的实现方式还包括 UTF-7、Punycode、CESU-8、SCSU、UTF-32、GB18030 等，这些实现方式有些仅在一定的国家和地区使用，有些则属于未来的规划方式。目前通用的实现方式是 UTF-16 小端序（LE）、UTF-16 大端序（BE）和 UTF-8。在微软公司 Windows XP 附带的记事本（Notepad）中，“另存为”对话框可以选择的四种编码方式除去非 Unicode 编码的 ANSI（对于英文系统即 ASCII 编码，中文系统则为 GB2312 或 Big5 编码）外，其余三种为 “Unicode”（对应 UTF-16 LE）、“Unicode big endian”（对应 UTF-16 BE）和 “UTF-8”。

目前辅助平面的工作主要集中在第二和第三平面的中日韩统一表意文字中，因此包括 GBK、GB18030、Big5 等简体中文、繁体中文、日文、韩文以及越南喃字的各种编码与 Unicode 的协调性被重点关注。考虑到 Unicode 最终要涵盖所有的字符。从某种意义而言，这些编码方式也可视作 Unicode 的出现于其之前的既成事实的实现方式，如同 ASCII 及其扩展 Latin-1 一样，后两者的字符在 16 位 Unicode 编码空间中的编码第一字节各位全为 0，第二字节编码与原编码完全一致。但上述东亚语言编码与 Unicode 编码的对应关系要复杂得多。

参考：

[Unicode](https://www.wikiwand.com/zh-hans/Unicode)

## UTF-8

UTF-8（8-bit Unicode Transformation Format）是一种针对 Unicode 的可变长度字元编码，也是一种前缀码。它可以用来表示 Unicode 标准中的任何字元，且其编码中的第一个位元组仍与 ASCII 相容，这使得原来处理 ASCII 字元的软体无须或只须做少部份修改，即可继续使用。因此，它逐渐成为电子邮件、网页及其他储存或传送文字优先采用的编码。

UTF-8 使用一至六个位元组为每个字符编码（尽管如此，2003 年 11 月 UTF-8 被 RFC 3629 重新规范，只能使用原来 Unicode 定义的区域，U+0000 到 U+10FFFF，也就是说最多四个字节）：

---

- 1.128 个 US-ASCII 字符只需一个位元组编码（Unicode 范围由 U+0000 至 U+007F）。
- 2. 带有附加符号的拉丁文、希腊文、西里尔字母、亚美尼亚语、希伯来文、阿拉伯文、叙利亚文及它拿字母则需要两个位元组编码（Unicode 范围由 U+0080 至 U+07FF）。
- 3. 其他基本多文种平面（BMP）中的字元（这包含了大部分常用字，如大部分的汉字）使用三个位元组编码（Unicode 范围由 U+0800 至 U+FFFF）。
- 4. 其他极少使用的 Unicode 辅助平面的字元使用四至六位元组编码（Unicode 范围由 U+10000 至 U+1FFFFF 使用四字节，Unicode 范围由 U+200000 至 U+3FFFFFF 使用五字节，Unicode 范围由 U+4000000 至 U+7FFFFFFF 使用六字节）。

---

对上述提及的第四种字元而言，UTF-8 使用四至六个位元组来编码似乎太耗费资源了。但 UTF-8 对所有常用的字元都可以用三个位元组表示，而且它的另一种选择，UTF-16 编码，对前述的第四种字符同样需要四个位元组来编码，所以要决定 UTF-8 或 UTF-16 哪种编码比较有效率，还要视所使用的字元的分布范围而定。不过，如果使用一些传统的压缩系统，比如 DEFLATE，则这些不同编码系统间的的差异就变得微不足道了。若顾及传统压缩算法在压缩较短文字上的效果不大，可以考虑使用 Unicode 标准压缩格式（SCSU）。

网际网路工程工作小组（IETF）要求所有网际网路协议都必须支持 UTF-8 编码。互联网邮件联盟（IMC）建议所有电子邮件软件都支持 UTF-8 编码。

参考：

[UTF-8](https://www.wikiwand.com/zh-hans/UTF-8)

## UTF-16

UTF-16 是 Unicode 字符编码五层次模型的第三层：字符编码表（Character Encoding Form，也称为 "storage format"）的一种实现方式。即把 Unicode 字符集的抽象码位映射为 16 位长的整数（即码元）的序列，用于数据存储或传递。Unicode 字符的码位，需要 1 个或者 2 个 16 位长的码元来表示，因此这是一个变长表示。

Unicode 的编码空间从 U+0000 到 U+10FFFF，共有 1,112,064 个码位（code point）可用来映射字符。Unicode 的编码空间可以划分为 17 个平面（plane），每个平面包含 2^16（65,536）个码位。17 个平面的码位可表示为从 U+xx0000 到 U+xxFFFF，其中 xx 表示十六进制值从 00<sub>16</sub> 到 10<sub>16</sub>，共计 17 个平面。第一个平面称为基本多语言平面（Basic Multilingual Plane, BMP），或称第零平面（Plane 0）。其他平面称为辅助平面（Supplementary Planes）。基本多语言平面内，从 U+D800 到 U+DFFF 之间的码位区段是永久保留不映射到 Unicode 字符。UTF-16 就利用保留下来的 0xD800-0xDFFF 区段的码位来对辅助平面的字符的码位进行编码。

参考：

[UTF-16](https://www.wikiwand.com/zh-hans/UTF-16)
