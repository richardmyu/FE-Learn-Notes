### 5.String 对象

#### 5.1.概述

`String`对象是 JavaScript 原生提供的三个包装对象之一，用来生成字符串对象。

字符串对象是一个类似数组的对象（很像数组，但不是数组）。

```javascript
new String("abc");
// String {0: "a", 1: "b", 2: "c", length: 3}

new String("abc")[1]; // "b"
```

除了用作构造函数，`String` 对象还可以当作工具方法使用，将任意类型的值转为字符串。

#### 5.2.静态方法

##### 5.2.1 String.fromCharCode

该方法的参数是一个或多个数值，代表 Unicode 码点，返回值是这些码点组成的字符串。

```javascript
String.fromCharCode(); // ""
String.fromCharCode(97); // "a"
String.fromCharCode(104, 101, 108, 108, 111);
// "hello"
```

> 注意，该方法不支持 Unicode 码点大于 `0xFFFF` 的字符，即传入的参数不能大于 `0xFFFF`（即十进制的 65535）。这是因为 `String.fromCharCode` 发现参数值大于 `0xFFFF`，就会忽略多出的位。

这种现象的根本原因在于，码点大于 `0xFFFF` 的字符占用四个字节，而 JavaScript 默认支持两个字节的字符。这种情况下，必须把 `0x20BB7` 拆成两个字符表示。

```javascript
String.fromCharCode(0xd842, 0xdfb7);
// "𠮷"

String.fromCharCode(0xd842, 0xdfb7).repeat(3);
// "𠮷𠮷𠮷"
```

上面代码中，`0x20BB7` 拆成两个字符 `0xD842` 和 `0xDFB7`（即两个两字节字符，合成一个四字节字符），就能得到正确的结果。码点大于 `0xFFFF` 的字符的四字节表示法，由 UTF-16 编码方法决定。

> Unicode 和 UTF-8 一级 UTF-16 的区别见 <a href="./补充.md">补充.md</a>

#### 5.3.实例属性

##### 5.3.1 string.length

字符串实例的 `length` 属性返回字符串的长度。

#### 5.4.实例方法

##### 5.4.1 字符方法

访问字符串中特定的字符，这两个方法都接收一个参数，即字符索引；

1).`string.charAt(n)`

以单字符串的形式返回给定索引位置的字符；如果参数为负数，或大于等于字符串的长度，`charAt`返回空字符串。

> JavaScript 没有字符数据类型。

2).`string.charCodeAt(n)`

返回字符串指定位置的 `Unicode` 码点（十进制表示），相当于`String.fromCharCode()`的逆操作。

---

- 返回值：字符/字符编码
- 参数类型：字符索引
- 参数：只有一个参数
  - a.不传参数，`charAt()`返回首字符，`charCodeAt()`返回首字符的码点；
  - b.若传入参数是负数或大于等于字符长度，`charAt()`会返回空字符；而`charCodeAt()`会返回`NaN`。

---

```javascript
var str = "abcd";
str.charAt(0); //a
str.charCodeAt(0); //97
String.fromCharCode(str.charCodeAt(0)); //a
```

> 注意，`charCodeAt`方法返回的 `Unicode` 码点不会大于 65536（`0xFFFF`），也就是说，只返回两个字节的字符的码点。
> 如果遇到码点大于 65536 的字符（四个字节的字符），必需连续使用两次`charCodeAt`，不仅读入`charCodeAt(i)`，还要读入`charCodeAt(i+1)`，将两个值放在一起，才能得到准确的字符。

##### 5.4.2 字符串操作方法

1).`string.concat(value,...)`

用于将一个或多个字符串按照顺序拼接到原字符串的末尾；

---

- 返回值：返回一个新字符串；
- 参数类型：`String`
- 参数：
  - a.可以接受任意多参数，也就是说可以拼接任意多个字符串；实际更多用"`+`"，简便易行（特别是拼接多个）；
  - b.若传入的参数不是字符串形式，则会转换为字符串参与拼接；
  - c.若写成变量的形式，会在全局查找该变量，并将该变量的值代入，若在全局找不到该变量，则会报错；

---

2).**`string.slice(start[,end])`**

复制字符串中从索引 start 到索引 end(包括 start,不包括 end)的字符

---

- 返回值:复制出来的新字符串
- 参数类型：数值
- 参数：
  - a.不传参数表示全部查找,等价于克隆
  - b.只传一个参数的时候:从索引 start 一直查找到最后
  - c.第二个参数指定复制截止的位置（本身不复制）
  - d.如果第二个参数比第一个参数小，为空字符串；
  - e.如果第二个参数大于字符串的`length`的，默认是查找到最后
  - f.如果参数是负值，将传入的负值与字符串的长度相加，遵循以上规则再进行复制（也可以看做从尾部倒数开始）；

---

3).**`string.substring(start[,end])`**

复制字符串中从索引 start 到索引 end(包括 start,不包括 end)的字符

---

- 返回值:查找出的新的字符串
- 参数类型：数值
- 参数：
  - a.不传参数表示全部查找
  - b.只传一个参数的时候:从索引 n 一直查找到最后
  - c.第二个参数指定复制截止的位置（本身不复制）
  - d.如果第二个参数比第一个参数小，互换位置再执行查找；
  - e.如果第二个参数超过字符长度，则默认复制到最后；
  - f.如果参数是负值，将所有负值转换为 0，遵循以上规则再进行复制；

---

4).`string.substr(start[,length])`

复制字符串中从索引 n 开始查找 m 个字符

---

- 返回值:查找出的新的字符串
- 参数类型：数值
- 参数：
  - a.不传参数表示全部查找
  - b.如果只有一个参数:从索引 n 一直查找到最后；
  - c.第二个参数指定复制字符的长度
  - d.如果第二个参数超过字符长度，则默认复制到最后；
  - e.参数是负值：若第一个参数是负值，则加上字符串的长度；若第二个参数是负值，则将其变为 0，返回空字符串；

---

##### 5.4.3 字符串位置方法

> **区分大小写**

1).**`string.indexOf(substring[,start])` **

在字符串中从前往后搜索，判断某个字符在不在这个字符串中（只在乎第一次出现），找不到子字符串则返回-1；

---

- 返回值：指定字符的索引或者-1；
- 参数类型：字符(非字符类型被转化为字符)/数值
- 参数：
  - a.不传参数，默认为找不到子字符串，返回-1；
  - b.第一个参数指定搜索的字符(包括空格和符号)；
  - c.第二个参数，指定开始搜索的位置，默认为 0；
  - d.若第二个参数小于 0，视为输入 0；若大于等于字符长度，视为输入`str.length`；

---

2).**`string.lastIndexOf(substring[,start])`**

在字符串中从后往前搜索，判断某个字符在不在这个字符串中（只在乎第一次匹配），找不到子字符串则返回-1；

---

- 返回值：指定字符的索引或者-1；
- 参数类型：字符(非字符类型被转化为字符)/数值
- 参数：
  - a.不传参数，默认为找不到子字符串，返回-1；
  - b.第一个参数指定搜索的字符(包括空格和符号)；
  - c.第二个参数，指定开始搜索的位置，默认为`str.length`；
  - d.若第二个参数小于 0，视为输入 0；若大于等于字符长度，视为输入`str.length`；

---

> 对于`indexOf()`与`lastIndexOf()`，若是查找空字符或空数组时，则其返回值为第二个可选参数的值（没有就是默认值），注意当第二个参数的值大于字符长度时，返回值为字符长度，若是负数则返回 0。

##### 5.4.4 空格处理

1).`string.trim()`

创建一个字符串的副本；删除前置及后缀的所有空格，然后返回结果；不修改原字符串；

---

- 返回值：新字符串
- 没有参数，传参不报错，但是无效

---

> 该方法去除的不仅是空格，还包括制表符（`\t`、`\v`）、换行符（`\n`）和回车符（`\r`）。

##### 5.4.5 字符串大小写转换方法

1).`string.toUpperCase()`
2).`string.toLowerCase()`
3).`string.toLocaleLowerCase()`
4).`string.toLocaleUpperCase()`

> `toUpperCase()`和`toLowerCase()`借鉴`Java.lang.String`中的同名方法；
> `toLocaleLowerCase()`和`toLocaleUpperCase()`是针对特定地区的实现；

---

- 返回值：新字符串
- 没有参数，传参不报错，但是无效

---

> 对于`toLocaleLowerCase()`和`toLocaleUpperCase()`传入参数为`null`或`undefined`会报错：`Uncaught TypeError: Cannot convert undefined or null to object at String.toLocaleLowerCase (native)`

##### 5.4.6 字符串的模式匹配方法

1).**`string.match(str/reg)`**

找到一个或多个正则表达式的匹配结果（在字符串上调用这个方法，本质上与调用`RegExp`的`exec()`方法相同）。

---

- 返回值：一个数组或`null`；
- 参数类型：正则表达式/`RegExp`对象
- 参数：只接受一个参数
  - 不传参数，匹配项返回空字符

---

```javascript
var s = "green yellow";

console.log(s.match());
//["", index: 0, input: "green yellow"]

console.log(s.match(/(en)/));
//["e", index: 2, input: "green yellow"]

console.log(/(e)/g.exec(s));
//["e", "e", index: 2, input: "green yellow"]
```

如果参数没有“`g`”标志，`match()`将只进行一次匹配。

如果没有匹配结果，则返回`null`；若有匹配结果，第一项是匹配项，之后每一项保存正则表达式圆括号子表达式匹配的字符串（若有），倒数第二项是匹配项的首字符的索引；最后一项是原字符；

如果参数有“`g`”标志，则`match()`进行一次全局搜索。全局匹配返回的数组和非全局匹配返回的数组内容很不一样。在全局匹配的情况下，数组元素包含`string`中每一个匹配子串，同时返回的数组没有`index`和`input`属性。

> 注意:对于全局匹配，`match()`不会提供有关捕获组的信息，也不会记录每个匹配的子串在`string`中的位置。若想在全局搜索时获取这些信息，可以使用`RegExp.exec()`。

2).`string.search(str/reg)`

根据正则表达式在 string 中寻找匹配的字符串；

---

- 返回值：返回字符串中第一个匹配项的索引；如果找不到匹配项，则返回-1；
- 参数类型：正则表达式/RegExp 对象
- 参数：只接受一个参数

---

`search()`不执行全局匹配，会忽略“`g`”标志。也会忽略`regexp`的`lastIndex`属性，总是从开头位置开始搜索，这意味着它总是返回第一个匹配子串的位置。

##### 5.4.7 字符串的替换

1).**`string.replace(regexp[,replacement])`**

替换给定正则表达式匹配的（一个或多个）子表达式；

---

- 返回值：新字符串，其中匹配的项(正则的最大匹配项)已替换为 replacement（可以组合）
- 参数类型：`RegExp`对象/字符串，字符/function
- 参数：
  - a.不传参数，则返回原字符串
  - b.第一个参数可以是一个`RegExp`对象或者一个字符串（这个字符串不会被转换为正则表达式）；
  - c.只传一个参数：若能匹配，则将匹配项替换成`undefined`；若不能匹配，则返回原字符串
  - d.第二个参数是替换文本，可以是一个字符串或者一个函数，用于在调用时生成对应的替换文本（如果第一个参数是字符串，只替换第一个子字符串，要想替换所有子字符串，提供一个正则表达式和全局标志）。
  - e.如果第二个参数是字符串，那么还可以使用一些特殊的字符序列，将正则表达式操作得到的值插入到结果字符串中。

---

> 更具体的用法见`RegExp`的相关章节。

##### 5.4.8 字符串变数组

1).**`string.split(delimiter[,limit])`**

基于指定的分隔符将一个字符串分割成多个子字符串，并将结果放到一个数组中

---

- 返回值：返回一个字符串组成的数组（不包含分割文本，有捕获组的正则表达式这个情况）
- 参数类型：字符串/RegExp 对象,数值；
- 参数：
  - a.不传参数，则默认将变成一个字符串数组；
  - b.若分隔符不匹配，也是整体变成字符串；
  - c.若分隔符出现在开头或结尾，则返回的数组的第一项或最后一项是空字符
  - d.若分隔符是`""`或者匹配空字符的正则，会将字符串的每一项拆分成数组的一项，返回的数组具有与`string`一样长度的（只是在没有指定更小`limit`的情况下，注意这是一个特例，因为第一个字符之前后最后一个字符之后的空字符不匹配）
  - e.可以接受可选的第二个参数，用于指定返回数组的大小，确保返回的数组不会超过既定大小；没有指定，则将切分整个字符串；
  - f.如果第二个参数是包含圆括号的正则表达式，则匹配这些圆括号表达式的子串将包含在返回的数组中。

---

```javascript
var s = "s1,s2,s3";
console.log(s.split()); //["s1,s2,s3"]
console.log(s.split(" ")); //["s1,s2,s3"]
console.log(s.split(",")); //["s1", "s2", "s3"]
console.log(s.split(/s/)); //["", "1,", "2,", "3"]
console.log(s.split("")); //["s", "1", ",", "s", "2", ",", "s", "3"]
```

> 对`split()`中正则的支持因浏览器而异。尽管对于简单模式没有声明差别，但对于未发现匹配项以及带有捕获组的模式，匹配的行为就大相径庭了。差别如下：
> IE8 及之前版本会忽略捕获组。ECMCA-262 规定应该把捕获组的内容拼接到结果数组中。IE 能正确地在结果中包含捕获组；
> Firefox3.6 及之前版本在捕获组为捕获到匹配项时，会在结果中包含空字符；ECMCA-262 规定没有匹配项的捕获组在结果数组中应该用`undefined`表示；

##### 5.4.9 字符串比较

1).`string.localeCompare(target)`

根据本地默认的排序比较两个字符串（逐个比较），

---

- 返回值：
  - 如果`target`中的字符排在`string`字符串之前，则返回一个负数（大多数情况下是-1，具体值看具体情况）；
  - 如果等于，返回 0；
  - 如果排在后面，则返回正数（大多数情况下是 1，具体值看具体情况）；
- 参数类型：字符串
- 参数：一个

---

方法的最大特点，就是会考虑自然语言的顺序。举例来说，正常情况下，大写的英文字母小于小写字母。因为 JavaScript 采用的是 `Unicode` 码点比较，B 的码点是 66，而 a 的码点是 9。但是，`localeCompare`方法会考虑自然语言的排序情况，将 B 排在 a 的前面。

`localeCompare`还可以有第二个参数，指定所使用的语言（默认是英语），然后根据该语言的规则进行比较。

##### 5.4.10 ES6 新方法

1).**`string.includes(string)`**

判断某个字符或子字符串在不在某个字符串中

---

- 返回值:true/false, 有就是 true,没有就是 false;
- 参数类型：`string`（非字符类型被强制转换为字符）
- 参数：一个
  - a.输入多个参数不报错，但只有第一个参数有效；
  - b.不传参数则无法匹配，就会返回 false；

---

2).**`string.repeat(n)` ** 重复字符

将字符串重复 n 次

---

- 返回值:重复后的新字符串;
- 参数类型：非负数值
- 参数：只有一个参数
  - a.若参数是小数:只取整数部分（即向下取整）
  - b.若参数是负数，则报错

---

3).`扩展运算符（...）`

扩展运算符；在字符中的作用类似`split()`

---

- 返回值：
  - a.单个字符串，没有中括号的情况下产生一连串的单字符串；
  - b.若有中括号，会将单字符串放进一个数组返回；用小括号包裹会报错

---

```javascript
var str = "meih";
console.log(...str); //m e i h
console.log(...(str + "a")); //m e i h a
console.log([...str]); //["m", "e", "i", "h"]

//可以将类数组转换为数组；
function f1() {
  console.log([...arguments]);
}
f1(1, 2, 3, 4); //[1, 2, 3, 4]
```
