# 前端组件化设计思路

## 什么是前端组件化开发

你应该遇到过，将一个页面的几百行，甚至上千行的代码逻辑写在一个 js 文件中的情况。通常这种代码都很难读下去，更别说要维护起来，添加新功能，移除一些老功能了，因为你不知道改动一个地方，会不会出现意想不到的 bug。

这个时候，你就需要利用组件化开发，拆分功能，封装组件，单独维护。

现代化前端框架通常都是实现 MVVM 的方案，数据层（M）和 视图层（V）相互连接，同时变更，使得页面交互保持高度的一致性。

如果你熟悉 Java，Python，Go 等后端开发语言，你应该对 package （包）的概念很熟悉，前端的组件化在概念上与后端的 package 很相似，只不过前端的组件涉及到更多的是展示和交互方面的逻辑。当然，前端组件与后端架构的微服务概念类似，可以理解成一个组件就是一个服务组件，只提供某个服务。

前端组件化开发，就是将页面的某一部分独立出来，将这一部分的 数据层（M）、视图层（V）和 控制层（C）用黑盒的形式全部封装到一个组件内，暴露出一些开箱即用的函数和属性供外部组件调用。

一个前端组件，包含了 HTML、CSS、JavaScript，包含了组件的模板、样式和交互等内容，基本上涵盖了组件的所有的内容，外部只要按照组件设定的属性、函数及事件处理等进行调用即可，完全不用考虑组件的内部实现逻辑，对外部来说，组件是一个完全的黑盒。

组件可以多层封装，通过调用多个小组件，最后封装成一个大组件，供外部调用。比如：一个 Input 输入框 是一个组件，一个 Select 下拉选择框 也是一个组件，可以用 form 在这两个组件上包装一层，就是一个 Form 的组件。

有一些比较常用的前端组件，像 vue-router，vuex，react-router，redux，mobx 等，都是基于 Vue 和 React 的组件，它们只专注于 路由、状态存储 的工作，并且把这些事情做好。

只要利用好组件化开发，开发一个页面，就像是搭积木一样，将各个组件拼接到一起，最后融合到一起，就是一个完整的系统。

## 组件化开发的优点

组件封装有一定的不确定性，更多时候是在做几个方面的权衡，并且在业务不断变化中，可能还会面临一些调整和重构。

说到底，前端的组件化开发，可以很大程度上降低系统各个功能的耦合性，并且提高了功能内部的聚合性。这对前端工程化及降低代码的维护来说，是有很大的好处的。

耦合性的降低，提高了系统的伸展性，降低了开发的复杂度，提升开发效率，降低开发成本。

组件化开发的意义有很多，如果认为只是为了复用（包括对于模块化的理解），认为只有一个地方用就没必要抽取封装为组件，但实则不尽然：

- 组件化是对实现的分层，是更有效地代码组合方式
- 组件化是对资源的重组和优化，从而使项目资源管理更合理
- 组件化有利于单元测试
- 组件化对重构较友好

## 组件与模块

模块(Module)通常强调的是职责（分离、内聚），组件是可复用模块和相关依赖的封装。

组件可以如下定义：

---

- 可复用的模块，完成既定功能
- 有明确的接口规定
- 有上下文依赖、外部依赖资源的定义
- 可以独立发布

---

## 组件设计的原则

新手常常会更多地从实现（如所用的框架 Vue 的组件实现方式）直觉角度定义组件，并且隘于视角较局限，经验较欠缺，对于职责划分不合理。

以下原则尽可能使用，用得越多就组件的复用性就越好。

---

- 1.适用单一职责原则
- 2.适用开放封闭原则
- 3.追求短小精悍
- 4.避免太多参数
- 5.缩小信赖范围和向稳定方向信赖
- 6.适用 SPOT 法则 (Single Point Of Truth，就是尽量不要重复代码，出自《The Art of Unix Programming》)
- 7.追求无副作用
- 8.追求引用透明
- 9.避免暴露组件内部实现
- 10.避免直接操作 DOM
- 11.适用好莱坞法则 (好莱坞法则： Don't call us, we'll call you, 又称 IoC, Inversion of control, 控制反转)
- 12.入口处检查参数的有效性，出口处检查返回的正确性
- 13.充分隔离变化的部分
- 14.组件和数据分享，信赖一致性的数据结构

---

## 自省的几个问题

以上原则有点太教科书，不结合长期的实践深刻理解，很难灵活运用，所以我设计了以下几个自省问题，在思考一个组件时候，从这几个问题入手，引导完善组件的设计。

- **这个组件可否（有必要）再分**？

组件划分的依据通常是 业务逻辑、功能，要考虑各组件之间的关系是否明确（如组件树方式管理组件间依赖关系，兄弟组件不可见），以及组件的可复用度。

划分粒度的大小需要根据实际情况权衡，太小会提升维护成本，太大又不够灵活和高复用性。

每一个组件都应该有其独特的划分目的的，有的是为了复用实现，有的是为了封装复杂度清晰业务实现。

- **这个组件的依赖是否可再缩减**？

缩减组件依赖可以提高组件的可复用度，常用的方法是 IoC（依赖注入），对外弱类型依赖。

- **这个组件是否对其它组件造成侵入**？

一个组件的封装性不够，或者自身越界操作，就可能对自身之外造成了侵入，这种情况应该尽量避免，确保组件的生命周期能够对其影响进行有效的管理（如 destroy 后不留痕迹）。

较常见的一种情况是：组件运行时对 window 对象添加 resize 监听事件以实现组件响应视窗尺寸变化事件，这种需求的更好替代方案是：组件提供刷新方法，由父组件实现调用（最终由根组件统一处理）。

次优的方案是，当组件 destroy 前清理恢复。

一个组件不应对其它兄弟组件造成直接影响。

- **这个组件可否复用于其它类似场景中**？

需要考虑需要适用的不同场景，在组件接口设计时进行必要的兼容。

- **这个组件当别人用时，会怎么想**？

接口设计符合规范和大众习惯，尽量让别人用起来简单易上手，易上手是指更符合直觉。

- **假如业务需要不需要这个功能，是否方便清除**？

各组件之前以组合的关系互相配合，也是对功能需求的模块化抽象，当需求变化时可以将实现以模块粒度进行调整。

参考：

[前端组件化设计思路](https://ijser.cn/2017/06/25/web-component-design-in-front-end/)

[深入探讨前端组件化开发](https://juejin.im/entry/59f84b9d5188253bd85cad9b)

[UI components by design](https://www.thoughtworks.com/insights/blog/ui-components-design)
