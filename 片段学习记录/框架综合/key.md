# 1.写 React / Vue 项目时为什么要在列表组件中写 key，其作用是什么

key 的作用是为了在 diff 算法执行时更快的找到对应的节点，提高 diff 速度。

vue 和 react 都是采用 diff 算法来对比新旧虚拟节点，从而更新节点。vue 和 react 虽然都采用了 diff 算法。 但是 diff 设计是截然不同的， vue 采用依赖收集追踪，可以更加细粒度的更新组件，即给模板使用到的每一个属性绑定监听；而 react 是采用自顶而下的更新策略，每次小的改动都会生成一个全新的 vdom。

在交叉对比中，当新节点跟旧节点头尾交叉对比没有结果时，会根据新节点的 key 去对比旧节点数组中的 key，从而找到相应旧节点（这里对应的是一个 key => index 的 map 映射）。如果没找到就认为是一个新增节点。而如果没有 key，那么就会采用遍历查找的方式去找到对应的旧节点。一种一个 map 映射，另一种是遍历查找，相比而言，map 映射的速度更快。

**vue**

为了给 Vue 一个提示，以便它能跟踪每个节点的身份，从而重用和重新排序现有元素，你需要为每项提供一个唯一 key attribute：

```jsx
<div v-for="item in items" v-bind:key="item.id">
  <!-- 内容 -->
</div>
```

建议尽可能在使用 `v-for` 时提供 key attribute，除非遍历输出的 DOM 内容非常简单，或者是刻意依赖默认行为以获取性能上的提升。

key 的主要用在 Vue 的虚拟 DOM 算法，在新旧 nodes 对比时辨识 VNodes。如果不使用 key，Vue 会使用一种最大限度减少动态元素并且尽可能的尝试就地修改/复用相同类型元素的算法。而使用 key 时，它会基于 key 的变化重新排列元素顺序，并且会移除 key 不存在的元素。

> [维护状态](https://cn.vuejs.org/v2/guide/list.html#%E7%BB%B4%E6%8A%A4%E7%8A%B6%E6%80%81)
> [key](https://cn.vuejs.org/v2/api/#key)

**React**

key 帮助 React 识别哪些元素改变了，比如被添加或删除。一个元素的 key 最好是这个元素在列表中拥有的一个独一无二的字符串。

如果列表项目的顺序可能会变化，我们不建议使用索引来用作 key 值，因为这样做会导致性能变差，还可能引起组件状态的问题。

由于 React 依赖探索的算法，因此当以下假设没有得到满足，性能会有所损耗。

1. 该算法不会尝试匹配不同组件类型的子树。如果你发现你在两种不同类型的组件中切换，但输出非常相似的内容，建议把它们改成同一类型。在实践中，我们没有遇到这类问题。
2. Key 应该具有稳定，可预测，以及列表内唯一的特质。不稳定的 key（比如通过 `Math.random()` 生成的）会导致许多组件实例和 DOM 节点被不必要地重新创建，这可能导致性能下降和子组件中的状态丢失。

> [key](https://zh-hans.reactjs.org/docs/lists-and-keys.html)
> [Keys](https://zh-hans.reactjs.org/docs/reconciliation.html#recursing-on-children)

**小结**

不带有 key，并且使用简单的模板，基于这个前提下，可以更有效的复用节点，diff 速度来看也是比不带 key 的更加快，因为带 key 在增删节点上有耗时。这就是 vue 文档所说的默认模式。但是这个并不是 key 的作用，而是没有 key 的情况下可以对节点应用 in-place patch（就地复用）策略，提高性能。

> **就地复用**: 如果数据项的顺序被改变，Vue 将不会移动 DOM 元素来匹配数据项的顺序， 而是简单复用此处每个元素。

这种模式会带来一些隐藏的副作用，比如可能不会产生过渡效果，或者在某些节点有绑定数据（表单）状态，会出现状态错位。VUE 文档也说明了 这个默认的模式是高效的，但是只适用于不依赖子组件状态或临时 DOM 状态 (例如：表单输入值) 的列表渲染输出。

> 出处：[第 1 题：写 React / Vue 项目时为什么要在列表组件中写 key，其作用是什么？ #1](https://github.com/Advanced-Frontend/Daily-Interview-Question/issues/1)
