<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>构造函数与 new 命令</title>
  </head>
  <body>
    <script>
      // var Vehicle = function(p) {
      //   this.price = p;
      //   console.log(this);
      // };

      // var v = new Vehicle(100);
      // console.log(v.price);

      // function Fubar(foo, bar) {
      //   "use strict";
      //   this._foo = foo;
      //   this._bar = bar;
      // }

      // Fubar();
    </script>
    <script>
      // function Fubar(foo, bar) {
      //   if (!(this instanceof Fubar)) {
      //     return new Fubar(foo, bar);
      //   }

      //   this.foo = foo;
      //   this.bar = bar;
      // }

      // console.log(Fubar(1, 2));
      // //Fubar {foo: 1, bar: 2}
      // console.log(new Fubar(1, 2));
      // //Fubar {foo: 1, bar: 2}
      // console.log(Fubar(1,2).foo);//1
      // console.log(new Fubar(1,2).foo);//1
    </script>
    <script>
      function _new(constructor, params) {
        //constructor  构造函数
        //params  构造函数参数

        // 将 arguments 对象转为数组
        var args = [].slice.call(arguments);

        // 取出构造函数
        var constructor = args.shift();

        // 创建一个空对象，继承构造函数的 prototype 属性
        var context = Object.create(constructor.prototype);

        // 执行构造函数(将 this 指向空对象)
        var result = constructor.apply(context, args);

        // 如果返回结果是对象，就直接返回，否则返回 context 对象
        return typeof result === "object" && result != null ? result : context;
      }

      // 构造函数
      function Person(name, age) {
        this.name = name;
        this.age = age;
      }
      // 实例
      var actor = _new(Person, "张三", 28);
      console.log(actor);
      //Person {name: "张三", age: 28}

      // 构造函数2
      function Kids(name, age) {
        this.name = name;
        this.age = age;
        if (arguments[2]) {
          this.sex = arguments[2];
        } else {
          this.sex = "女";
        }
      }
      // 实例2
      var kid1 = _new(Kids, "bab", 2, "男");
      var kid2 = _new(Kids, "bab", 2);
      console.log(kid1);
      //Kids {name: "bab", age: 2, sex: "男"}
      console.log(kid2);
      //Kids {name: "bab", age: 2, sex: "女"}
    </script>
    <script>
      // function f() {
      //   if (!new.target) {
      //     throw new Error("请使用 new 命令调用！");
      //   }
      //   // ...
      // }

      // f(); // Uncaught Error: 请使用 new 命令调用！
    </script>
    <script>
      var person1 = {
        name: "张三",
        age: 38,
        greeting: function() {
          console.log("Hi! I'm " + this.name + ".");
        }
      };

      var person2 = Object.create(person1);

      console.log(person2.name); // 张三
      person2.greeting(); // Hi! I'm 张三
    </script>
  </body>
</html>
